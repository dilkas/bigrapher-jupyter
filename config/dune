(library
  (name        utils)
  (synopsis    "Functions used in multiple places")
  (modes       byte)
  (modules     Utils)
  (libraries   unix))

(executables
 (names       configure kernelspec)
 (libraries   unix yojson utils)
 (modules     Configure Kernelspec)
 (flags       (:standard
               -w A-4-31-33-34-39-41-42-43-44-45-48-49-50-58
               -safe-string -strict-sequence -strict-formats
               -short-paths)))

;;
;; Common OCaml flags: ocaml_flags.sexp, ocaml_test_flags.sexp
;;

(rule
 (targets ocaml_flags.sexp)
 (deps    configure.exe)
 (action  (run %{deps} -o %{targets}
               -ppx ppx_deriving_yojson
               -ppx lwt_ppx
               -ocamlfind %{bin:ocamlfind}
               -ocaml-flag "-w A-4-31-33-34-39-41-42-43-44-45-48-49-50-58"
               -ocaml-flag "-safe-string -strict-sequence -strict-formats"
               -ocaml-flag "-short-paths")))

(rule
 (targets ocaml_test_flags.sexp)
 (deps    configure.exe)
 (action  (run %{deps} -o %{targets}
               -ppx ppx_deriving.show
               -ocamlfind %{bin:ocamlfind})))

;;
;; kernelspec: kernel.json
;;

(rule
 (targets kernel.json)
 (deps    kernelspec.exe)
 (action  (run %{deps})))

(install
 (section share)
 (package jupyter)
 (files   kernel.json))
